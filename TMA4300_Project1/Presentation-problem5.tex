\documentclass[11pt]{beamer}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{graphicx}

\usepackage{listings}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},    
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}
\usepackage{amsmath}


\usetheme{Berlin}
\useinnertheme[shadows]{rounded}
\useoutertheme{infolines}
\beamertemplatenavigationsymbolsempty


\newcommand{\EE}{\mathbb{E}}
\newcommand{\PP}{\mathbb{P}}



\usepackage{palatino}
\usefonttheme{serif}


\title {Project 1 - problem 5}
\author {Alessandro Cavalieri, Miha Novoselec}
\institute[NTNU]{NTNU}
\date{6th february 2026}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}


\begin{frame}{Problem 5a}
  \begin{block}{Goal}
    We want to simulate from the joint distribution of $X$ and $Y$ given the joint density function:
    $$F_{X,Y}(x,y) = \exp{\left(-\frac{1}{x} - \frac{1}{y} - \frac{1}{xy}\right)} \quad \text{for } x>0, y>0.$$
  \end{block}
\end{frame}

\begin{frame}{Problem 5a}
  \begin{block}{Theoretical solution}
    \scriptsize
    Marginal cumulative distribution of $X$:
    $$F_X(x) = \lim_{y \rightarrow \infty} F_{X,Y}(x,y) = \exp{\left(-\frac{1}{x}\right)} \quad \text{for } x > 0.$$
    Use of formula:
    $$f_{Y|X}(y|x) = \frac{f_{X,Y}(x,y)}{f_X(x)} \quad \text{for } x > 0, y > 0,$$
    Derivation:
    $$f_{X,Y}(x,y) = \frac{\partial^2 F_{X,Y}(x,y)}{\partial x \partial y} = \left(\frac{1}{x^2 y^2} + \frac{1}{x^2} + \frac{1}{y^2}\right) \exp{\left(-\frac{1}{x} - \frac{1}{y} - \frac{1}{xy}\right)} \quad \text{for } x > 0, y > 0,$$
    $$f_X(x) = \frac{\partial F_X(x)}{\partial x} = \frac{1}{x^2} \cdot \exp{\left(-\frac{1}{x}\right)} \quad \text{for } x > 0.$$
  \end{block} 
\end{frame} 

\begin{frame}{Problem 5a}
  \begin{block}{Theoretical solution}
    \scriptsize
    Conditional density:
    $$f_{Y|X}(y|x) = \exp{\left(-{\frac{1 + 1/x}{y}}\right)} \cdot \left(\frac{1 + 1/x}{y^2} + \frac{1}{y^3}\right) \quad \text{for } x > 0, y > 0.$$
    Integrate:
    $$F_{Y|X}(y|x) = \int_0^y f_{Y|X}(t|x) dt = \exp{\left(-\frac{1}{y}-\frac{1}{xy}\right)}\left(1 + \frac{1}{y}\right) \quad \text{for } x > 0, y > 0.$$
    It fits the proposed formula as:
    \begin{align*}
        F_{Y|X}(y|x) &= \frac{1}{f_X(x)} \cdot \frac{\partial}{\partial x} F_{X,Y}(x,y) = \\
        &= \frac{1}{\frac{1}{x^2} \exp{\left(-\frac{1}{x}\right)}} \cdot \frac{\partial}{\partial x} \exp{\left(-\frac{1}{x} - \frac{1}{y} - \frac{1}{xy}\right)} = \exp{\left(-\frac{1}{y}-\frac{1}{xy}\right)} \cdot \left(1 + \frac{1}{y}\right).
    \end{align*}
  \end{block}
\end{frame}

\begin{frame}{Problem 5a}
  \begin{block}{Theoretical solution}
    From density $f_{Y|X}(y|x)$ we recognize that $Y|X = x$ can be written as a sum of two independant random variables that have inverse Gamma distribution. Remember, that density of inverse Gamma distributed random variable is:
    $f(x, \alpha, \beta) = \frac{\beta^\alpha}{\Gamma(\alpha)} x^{-\alpha - 1} \exp{\left(-\frac{\beta}{x}\right)}$ for $x > 0, \alpha > 0, \beta > 0.$
  \end{block} 
\end{frame}

\begin{frame}{Problem 5a}
  \begin{block}{Theoretical solution}
  \scriptsize
  Therefore, we can write:
  \begin{align*}
      f_{Y|X}(y|x) &= \exp{\left(-\frac{1}{y} - \frac{1}{xy}\right)} \left(\frac{1 + 1/x}{y^2} + \frac{1}{y^3}\right) \\
      & = \frac{x}{x+1} \cdot \frac{(1 + 1/x)^{1}}{\Gamma(1)} y^{-2} \cdot \exp{\left(-\frac{1 + 1/x}{y}\right)} \\
      &  + \frac{1}{x+1} \cdot \frac{(1 + 1/x)^{2}}{\Gamma(2)} y^{-3} \cdot \exp{\left(-\frac{1 + 1/x}{y}\right)},
  \end{align*}
  in which we quickly recognize two inverse Gamma densities with parameters $\alpha_1 = 1, \beta_1 = 1 + 1/x$ and $\alpha_2 = 2, \beta_2 = 1 + 1/x$ and weights $w_1 = \frac{x}{x+1}$ and $w_2 = \frac{1}{x+1}$. 
  So, 
  $$Y|X = x \sim \frac{x}{x+1} \cdot IG(1, 1 + 1/x) + \frac{1}{1 + x} \cdot IG(2, 1 + 1/x).$$
  \end{block}
\end{frame}


\begin{frame}{Problem 5b}
  \begin{block}{Empirical simulation}
    We can now simulate data from joint distribution of X and Y by first simulating X. This is done by inverse method via random variable $U \sim unif(0,1)$ and as $U = F_X(x)= 1 - \exp(-1/x)$, we have $X = -\frac{1}{\log(U)}$. Next we simulate $Y|X = x$ as a mixture of two inverse Gamma distributions.
    First, we decide to define a new Bernoulli random variable Z with parameter $p = \frac{x}{x+1}$; if $Z = 1$ we simulate Y from $IG(1, 1 + 1/x)$ and if $Z = 0$ we simulate Y from $IG(2, 1 + 1/x)$. This way we have successfully simulated data from joint distribution of X and Y. 
  \end{block}
\end{frame}

\begin{frame}[fragile]{Problem 5b - R code}

\begin{lstlisting}[language=R]
#Simulating from joint density with our algorithm 
  simulate_XY <- function(n) {
  U <- runif(n)
  X <- 1 / (-log(U)) #simulate X
  Y <- numeric(n) #simulate Y|X
  
  for (i in seq_len(n)) {
    x <- X[i]
    beta <- 1 + 1 / x
    p <- x / (x + 1)
    Z <- rbinom(1, 1, p)
    if (Z == 1) {
      Y[i] <- 1 / rgamma(1, shape = 1, rate = beta)
    } else {
      Y[i] <- 1 / rgamma(1, shape = 2, rate = beta)
    }
  }
  list(X = X, Y = Y)
}
\end{lstlisting}
    
\end{frame}

\begin{frame}{Theoretical CDF and empirical CDF ($n = 50000$)}
    \begin{figure}
        \centering
        \includegraphics[width=1\linewidth]{CDF-plots.jpg}
        \caption{Cumulative Distribution Function (CDF) visualization.}
    \end{figure}
\end{frame}

\begin{frame}{Difference between CDF plots}
    \begin{figure}
        \centering
        \includegraphics[width=0.8\linewidth]{Difference.jpg}
        \caption{Analysis of the variation between the two distributions.}
    \end{figure}
\end{frame}


\begin{frame}[fragile]{Problem 5b - R code}
\begin{lstlisting}[language=R]
#Sanity check using supremum of differences using different n:
set.seed(123)

n_vals <- c(1000, 5000, 10000, 50000, 150000, 1000000)
sup_error <- numeric(length(n_vals))

for (k in seq_along(n_vals)) {
  n <- n_vals[k]
  sim <- simulate_XY(n)
  X <- sim$X
  Y <- sim$Y
  sup_error[k] <- max(abs(F_empirical - F_theoretical))
}
#Results for different n:
results <- data.frame(
  n = n_vals,
  sup_error = sup_error
)
print(results)
\end{lstlisting}
\end{frame}


\begin{frame}{Problem 5b}
  \begin{block}{Empirical simulation â€” results}
    \centering
    \begin{tabular}{r c}
      \hline
      $n$ & $\sup$ error \\
      \hline
      1\,000     & 0.06418686 \\
      5\,000     & 0.06203767 \\
      10\,000    & 0.05278686 \\
      50\,000    & 0.05670414 \\
      100\,000   & 0.05664686 \\
      500\,000 & 0.05377286 \\
      \hline
    \end{tabular}
  \end{block}
\end{frame}

\end{document}